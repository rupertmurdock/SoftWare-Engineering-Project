<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="chess.css">
        <title>CHESS: A GAME</title>
    </head>
    <body>
        <main>
            <div class="container">
                <div>
                    <button onclick="location.reload()">Refresh</button>
                </div>
                <div>
                    <button onclick="saveGame()">Save</button>
                </div>
                <div>
                    <button onclick="loadGame()">Resume</button>
                </div>
            </div>
            <br />
            <div class="board">
                <div id="timer"></div>
                <div class="whitesq draggable" data-row=0 draggable="false" data-col=0><div class="black" alt="Rook" id = "black-piece" draggable="true">♜</div></div>
                <div class="blacksq draggable" data-row=0 draggable="false" data-col=1><div class="black" alt="knight-piece" id = "black-piece" draggable="true">♞</div></div>
                <div class="whitesq draggable" data-row=0 draggable="false" data-col=2><div class="black" alt="bishop-piece" id = "black-piece" draggable="true">♝</div></div>
                <div class="blacksq draggable" data-row=0 draggable="false" data-col=3><div class="black" alt="queen-piece" id = "black-piece" draggable="true">♛</div></div>
                <div class="whitesq draggable" data-row=0 draggable="false" data-col=4><div class="black king" alt="king-piece" id = "black-king" draggable="true">♚</div></div>
                <div class="blacksq draggable" data-row=0 draggable="false" data-col=5><div class="black" alt="bishop-piece" id = "black-piece" draggable="true">♝</div></div>
                <div class="whitesq draggable" data-row=0 draggable="false" data-col=6><div class="black" alt="knight-piece" id = "black-piece" draggable="true">♞</div></div>
                <div class="blacksq draggable" data-row=0 draggable="false" data-col=7><div class="black" alt="rook-piece" id = "black-piece" draggable="true">♜</div></div>
                
                <div class="blacksq draggable" data-row=1 draggable="false" data-col=0><div class="black" alt="pawn-piece" id = "black-piece" draggable="true">♟</div></div>
                <div class="whitesq draggable" data-row=1 draggable="false" data-col=1><div class="black" alt="pawn-piece" id = "black-piece" draggable="true">♟</div></div>
                <div class="blacksq draggable" data-row=1 draggable="false" data-col=2><div class="black" alt="pawn-piece" id = "black-piece" draggable="true">♟</div></div>
                <div class="whitesq draggable" data-row=1 draggable="false" data-col=3><div class="black" alt="pawn-piece" id = "black-piece" draggable="true">♟</div></div>
                <div class="blacksq draggable" data-row=1 draggable="false" data-col=4><div class="black" alt="pawn-piece" id = "black-piece" draggable="true">♟</div></div>
                <div class="whitesq draggable" data-row=1 draggable="false" data-col=5><div class="black" alt="pawn-piece" id = "black-piece" draggable="true">♟</div></div>
                <div class="blacksq draggable" data-row=1 draggable="false" data-col=6><div class="black" alt="pawn-piece" id = "black-piece" draggable="true">♟</div></div>
                <div class="whitesq draggable" data-row=1 draggable="false" data-col=7><div class="black" alt="pawn-piece" id = "black-piece" draggable="true">♟</div></div>
                
                <div class="whitesq draggable" data-row=2 draggable="false" data-col=0><div class="square"   draggable="true"></div></div>
                <div class="blacksq draggable" data-row=2 draggable="false" data-col=1><div class="square"   draggable="true"></div></div>
                <div class="whitesq draggable" data-row=2 draggable="false" data-col=2><div class="square"   draggable="true"></div></div>
                <div class="blacksq draggable" data-row=2 draggable="false" data-col=3><div class="square"   draggable="true"></div></div>
                <div class="whitesq draggable" data-row=2 draggable="false" data-col=4><div class="square"   draggable="true"></div></div>
                <div class="blacksq draggable" data-row=2 draggable="false" data-col=5><div class="square"   draggable="true"></div></div>
                <div class="whitesq draggable" data-row=2 draggable="false" data-col=6><div class="square"   draggable="true"></div></div>
                <div class="blacksq draggable" data-row=2 draggable="false" data-col=7><div class="square"   draggable="true"></div></div>
                <div class="blacksq draggable" data-row=3 draggable="false" data-col=0><div class="square"   draggable="true"></div></div>
                <div class="whitesq draggable" data-row=3 draggable="false" data-col=1><div class="square"   draggable="true"></div></div>
                <div class="blacksq draggable" data-row=3 draggable="false" data-col=2><div class="square"   draggable="true"></div></div>
                <div class="whitesq draggable" data-row=3 draggable="false" data-col=3><div class="square"   draggable="true"></div></div>
                <div class="blacksq draggable" data-row=3 draggable="false" data-col=4><div class="square"   draggable="true"></div></div>
                <div class="whitesq draggable" data-row=3 draggable="false" data-col=5><div class="square"   draggable="true"></div></div>
                <div class="blacksq draggable" data-row=3 draggable="false" data-col=6><div class="square"   draggable="true"></div></div>
                <div class="whitesq draggable" data-row=3 draggable="false" data-col=7><div class="square"   draggable="true"></div></div>
                <div class="whitesq draggable" data-row=4 draggable="false" data-col=0><div class="square"   draggable="true"></div></div>
                <div class="blacksq draggable" data-row=4 draggable="false" data-col=1><div class="square"   draggable="true"></div></div>
                <div class="whitesq draggable" data-row=4 draggable="false" data-col=2><div class="square"   draggable="true"></div></div>
                <div class="blacksq draggable" data-row=4 draggable="false" data-col=3><div class="square"   draggable="true"></div></div>
                <div class="whitesq draggable" data-row=4 draggable="false" data-col=4><div class="square"   draggable="true"></div></div>
                <div class="blacksq draggable" data-row=4 draggable="false" data-col=5><div class="square"   draggable="true"></div></div>
                <div class="whitesq draggable" data-row=4 draggable="false" data-col=6><div class="square"   draggable="true"></div></div>
                <div class="blacksq draggable" data-row=4 draggable="false" data-col=7><div class="square"   draggable="true"></div></div>
                <div class="blacksq draggable" data-row=5 draggable="false" data-col=0><div class="square"   draggable="true"></div></div>
                <div class="whitesq draggable" data-row=5 draggable="false" data-col=1><div class="square"   draggable="true"></div></div>
                <div class="blacksq draggable" data-row=5 draggable="false" data-col=2><div class="square"   draggable="true"></div></div>
                <div class="whitesq draggable" data-row=5 draggable="false" data-col=3><div class="square"   draggable="true"></div></div>
                <div class="blacksq draggable" data-row=5 draggable="false" data-col=4><div class="square"   draggable="true"></div></div>
                <div class="whitesq draggable" data-row=5 draggable="false" data-col=5><div class="square"   draggable="true"></div></div>
                <div class="blacksq draggable" data-row=5 draggable="false" data-col=6><div class="square"   draggable="true"></div></div>
                <div class="whitesq draggable" data-row=5 draggable="false" data-col=7><div class="square"   draggable="true"></div></div>
    
                <div class="whitesq draggable" data-row=6 draggable="false" data-col=0><div class="white" alt="pawn-piece" id = "white-piece" draggable="true">♟</div></div>
                <div class="blacksq draggable" data-row=6 draggable="false" data-col=1><div class="white" alt="pawn-piece" id = "white-piece" draggable="true">♟</div></div>
                <div class="whitesq draggable" data-row=6 draggable="false" data-col=2><div class="white" alt="pawn-piece" id = "white-piece" draggable="true">♟</div></div>
                <div class="blacksq draggable" data-row=6 draggable="false" data-col=3><div class="white" alt="pawn-piece" id = "white-piece" draggable="true">♟</div></div>
                <div class="whitesq draggable" data-row=6 draggable="false" data-col=4><div class="white" alt="pawn-piece" id = "white-piece" draggable="true">♟</div></div>
                <div class="blacksq draggable" data-row=6 draggable="false" data-col=5><div class="white" alt="pawn-piece" id = "white-piece" draggable="true">♟</div></div>
                <div class="whitesq draggable" data-row=6 draggable="false" data-col=6><div class="white" alt="pawn-piece" id = "white-piece" draggable="true">♟</div></div>
                <div class="blacksq draggable" data-row=6 draggable="false" data-col=7><div class="white" alt="pawn-piece" id = "white-piece" draggable="true">♟</div></div>
    
                <div class="blacksq draggable" data-row=7 draggable="false" data-col=0><div class="white" alt="castle-piece" id = "white-piece" draggable="true">♜</div></div>
                <div class="whitesq draggable" data-row=7 draggable="false" data-col=1><div class="white" alt="knight-piece" id = "white-piece" draggable="true">♞</div></div>
                <div class="blacksq draggable" data-row=7 draggable="false" data-col=2><div class="white" alt="bishop-piece" id = "white-piece" draggable="true">♝</div></div>
                <div class="whitesq draggable" data-row=7 draggable="false" data-col=3><div class="white" alt="queen-piece" id = "white-piece" draggable="true">♛</div></div>
                <div class="blacksq draggable" data-row=7 draggable="false" data-col=4><div class="white king" alt="king-piece" id = "white-king" draggable="true">♚</div></div>
                <div class="whitesq draggable" data-row=7 draggable="false" data-col=5><div class="white" alt="bishop-piece" id = "white-piece" draggable="true">♝</div></div>
                <div class="blacksq draggable" data-row=7 draggable="false" data-col=6><div class="white" alt="knight-piece" id = "white-piece" draggable="true">♞</div></div>
                <div class="whitesq draggable" data-row=7 draggable="false" data-col=7><div class="white" alt="castle-piece" id = "white-piece" draggable="true">♜</div></div>
            </div>

            <div>
                <input type="button" id="wChess" name="wChess" value="Win">
                <input type="button" id="dChess" name="dChess" value="Draw">
                <input type="button" id="lChess" name="lChess" value="Loss">
            </div>
        </main>

        <script type="module" src="chess.js"></script>
        <script>
            let key = "game";
            function saveGame() {
                const main = document.querySelector("main");
                // store content to local storage
                let x = localStorage.setItem(key, main.innerHTML);
                var storedValue = localStorage.getItem(key)
            }
            function loadGame() {
                let keyresume = key;
                var loadBoard = chessboard;
                var storedValue = localStorage.getItem(keyresume)
                if (storedValue){
                    const main = document.querySelector("main");
                    main.innerHTML = storedValue;
                }
                setTimeout(() => {
                const squares = document.querySelectorAll(".draggable");
                squares.forEach((square) => {
                square.addEventListener("dragstart", dragStart);
                square.addEventListener("dragover", dragOver);
                square.addEventListener("dragenter", dragEnter);
                square.addEventListener("dragleave", dragLeave);
                square.addEventListener("drop", dragDrop);
                });
                }, 0);
                timerElement = document.getElementById('timer');
                whosTurn = timerElement.innerHTML.substr(0,5);
                if (whosTurn=="White"){
                    whosTurn="white";
                    whiteTime=timerElement.title;
                }else{
                    whosTurn ="black";
                    blackTime=timerElement.title;
                }
            }
        </script>
    </body>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getDatabase, set, ref, update, child, get } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyBDZFqhkECAYqdxUDEUF96Rb9OCUh6Jl64",
          authDomain: "game-1-website.firebaseapp.com",
          databaseURL: "https://game-1-website-default-rtdb.firebaseio.com",
          projectId: "game-1-website",
          storageBucket: "game-1-website.appspot.com",
          messagingSenderId: "483277766163",
          appId: "1:483277766163:web:55358a49073017e46609e6"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth();

        document.getElementById('wChess').addEventListener('click', WChess);

        function WChess(){
            const user = auth.currentUser;

            if(auth.currentUser === null){
                alert('Please sign in before update the status.');
            }
            else{
                get(child(ref(database), 'users/' + user.uid))
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        update(ref(database, 'users/' + user.uid),{
                            chess_wins: snapshot.val().chess_wins + 1,
                        })
                    } 
                    else {
                        alert("No data available");
                    }
                })
                .catch((error) => {
                    const errorCode = error.code;
                    const errorMessage = error.message;

                    alert(errorMessage);
                });
            }
        }

        document.getElementById('dChess').addEventListener('click', DChess);

        function DChess(){
            const user = auth.currentUser;

            if(auth.currentUser === null){
                alert('Please sign in before update the status.');
            }
            else{
                get(child(ref(database), 'users/' + user.uid))
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        update(ref(database, 'users/' + user.uid),{
                            chess_draws: snapshot.val().chess_draws + 1,
                        })
                    } 
                    else {
                        alert("No data available");
                    }
                })
                .catch((error) => {
                    const errorCode = error.code;
                    const errorMessage = error.message;

                    alert(errorMessage);
                });
            }
        }

        document.getElementById('lChess').addEventListener('click', LChess);

        function LChess(){
            const user = auth.currentUser;

            if(auth.currentUser === null){
                alert('Please sign in before update the status.');
            }
            else{
                get(child(ref(database), 'users/' + user.uid))
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        update(ref(database, 'users/' + user.uid),{
                            chess_losses: snapshot.val().chess_losses + 1,
                        })
                    } 
                    else {
                        alert("No data available");
                    }
                })
                .catch((error) => {
                    const errorCode = error.code;
                    const errorMessage = error.message;

                    alert(errorMessage);
                });
            }
        }

      </script>

</html>